<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="None">
  
  <link rel="shortcut icon" href="../../../../img/favicon.ico">
  <title>Scrape Metrics from Your Prometheus Instance - Coherence Operator</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Scrape Metrics from Your Prometheus Instance";
    var mkdocs_page_input_path = "samples\\operator\\metrics\\own-prometheus\\README.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> Coherence Operator</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../../../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../../quickstart/">Quick Start</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../../user-guide/">User Guide</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../">Samples</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../..">Coherence Operator</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
    
    <li>Scrape Metrics from Your Prometheus Instance</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="scrape-metrics-from-your-prometheus-instance">Scrape Metrics from Your Prometheus Instance</h1>
<p>You can scrape the metrics from your own Prometheus Operator instance rather than using the <code>prometheusopeartor</code> subchart included with <code>coherence-operator</code>.</p>
<p>This sample shows you how to scrape metrics from your own Prometheus instance.</p>
<blockquote>
<p><strong>Note:</strong> Use of Prometheus and Grafana is available only when using the operator with Oracle Coherence 12.2.1.4.0 version.</p>
</blockquote>
<p><a href="../">Return to Metrics samples</a> / <a href="../../">Return to Coherence Operator samples</a> / <a href="../../../#list-of-samples">Return to samples</a></p>
<h2 id="installation-steps">Installation Steps</h2>
<ol>
<li>Install Coherence Operator</li>
</ol>
<p>When you install the <code>coherence-operator</code>, you must ensure to specify <code>--set prometheusoperator.enabled=false</code>
   or leave out the option completely, which also defaults to false.</p>
<p><code>bash
   --set prometheusoperator.enabled=false</code></p>
<p>Use the following command to install <code>coherence-operator</code> with <code>prometheusoperator</code> enabled:</p>
<p><code>bash
   $ helm install \
      --namespace sample-coherence-ns \
      --set imagePullSecrets=sample-coherence-secret \
      --name coherence-operator \
      --set prometheusoperator.enabled=false \
      coherence/coherence-operator</code></p>
<p>After the installation completes, list the pods:</p>
<p><code>bash
   $ kubectl get pods -n sample-coherence-ns</code>
   <code>console
   NAME                                  READY   STATUS    RESTARTS   AGE
   coherence-operator-665489854f-jr7qj   1/1     Running   0          9s</code></p>
<p>There is only a single <code>coherence-operator</code> pod.</p>
<ol>
<li>Install the Coherence cluster</li>
</ol>
<p><code>bash
   $ helm install \
      --namespace sample-coherence-ns \
      --name storage \
      --set clusterSize=3 \
      --set cluster=storage-tier-cluster \
      --set imagePullSecrets=sample-coherence-secret \
      --set "targetNamespaces={sample-coherence-ns}" \
      coherence/coherence</code></p>
<p>After the installation completes, list the pods:</p>
<p><code>bash
   $ kubectl get pods -n sample-coherence-ns</code>
   <code>console
   NAME                                  READY   STATUS    RESTARTS   AGE
   coherence-operator-665489854f-jr7qj   1/1     Running   0          3m
   storage-coherence-0                   1/1     Running   0          1m
   storage-coherence-1                   1/1     Running   0          1m
   storage-coherence-2                   0/1     Running   0          22s</code></p>
<h2 id="configure-your-prometheus-operator-to-scrape-coherence-pods">Configure Your Prometheus Operator to Scrape Coherence Pods</h2>
<p>Refer <a href="https://github.com/coreos/prometheus-operator/blob/master/Documentation/user-guides/getting-started.md">Prometheus Operator</a> documentation for information about how to configure and deploy a service monitor for your Prometheus Operator installation.</p>
<p>This section describes only the service monitor configuration as it relates to the Coherence Helm chart.</p>
<p><code>coherence-service-monitor.yaml</code> fragment:</p>
<pre><code>...
spec:
  selector:
    matchLabels:
      component: &quot;coherence-service&quot;
...
endpoints:
  - port: 9612
</code></pre>

<p>If the parameter <code>service.metricsHttpPort</code> is set when installing the Coherence Helm chart, replace <code>port: 9612</code> with the new value.</p>
<p>If the Coherence Helm chart parameter <code>store.metrics.ssl.enabled</code> is <code>true</code>, add <code>endpoints.scheme</code> value of <code>https</code> to <code>coherence-service-monitor.yaml</code> fragment.</p>
<p>There are a number of Coherence Grafana dashboards bundled in the Coherence Operator Helm chart under dashboards folder.
While Grafana have to be configured to the location of your Prometheus datasource, you can take advantage of these Coherence dashboards by extracting them from the Coherence Operator Helm chart.</p>
<h2 id="uninstall-the-charts">Uninstall the Charts</h2>
<p>Use the following commands to delete the chart installed in this sample:</p>
<pre><code class="bash">$ helm delete storage --purge
</code></pre>

<p>Before starting another sample, ensure that all the pods are removed from previous sample.</p>
<p>If you want to remove the <code>coherence-operator</code>, use the <code>helm delete</code> command.</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '../../../..';</script>
    <script src="../../../../js/theme.js" defer></script>
      <script src="../../../../search/main.js" defer></script>

</body>
</html>

<!--
MkDocs version : 1.0.4
Build Date UTC : 2019-09-04 11:29:27
-->
