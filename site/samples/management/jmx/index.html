<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="None">
    
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Coherence Operator</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
      <script src="../../../js/elasticlunr.min.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = (window === window.parent);
        
        var pageToc = [
          {title: "Access JMX in the Coherence Cluster Using JConsole and VisualVM", url: "#_top", children: [
              {title: "Prerequisites", url: "#prerequisites" },
              {title: "Installation Steps", url: "#installation-steps" },
              {title: "Uninstall the Charts", url: "#uninstall-the-charts" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>

<nav class="navbar wm-page-top-frame">
  <div class="container-fluid wm-top-container">
    
    <div class="wm-top-tool pull-right wm-vcenter">
      <form class="dropdown wm-vcentered" id="wm-search-form" action="../../../search.html">
        
        <button id="wm-search-show" class="btn btn-sm btn-default" type="submit"
          ><i class="fa fa-search" aria-hidden="true"></i></button>

        <div class="input-group input-group-sm wm-top-search">
          <input type="text" name="q" class="form-control" id="mkdocs-search-query" placeholder="Search" autocomplete="off">
          <span class="input-group-btn" role="search">
            
            <button class="btn btn-default dropdown-toggle collapse" data-toggle="dropdown" type="button"><span class="caret"></span></button>
            <ul id="mkdocs-search-results" class="dropdown-menu dropdown-menu-right"></ul>
            <button id="wm-search-go" class="btn btn-default" type="submit"><i class="fa fa-search" aria-hidden="true"></i></button>
          </span>
        </div>
      </form>
    </div>

    
    <div class="wm-top-tool wm-vcenter pull-right wm-small-left">
      <button id="wm-toc-button" type="button" class="btn btn-sm btn-default wm-vcentered"><i class="fa fa-th-list" aria-hidden="true"></i></button>
    </div>

    
    

    
    <a href="" class="wm-top-brand wm-top-link wm-vcenter">
      
      <div class="wm-top-title">
        Coherence Operator<br>
        
      </div>
    </a>
  </div>
</nav>

  <div id="main-content" class="wm-page-top-frame">
    
<nav class="wm-toc-pane">
  
  <ul class="wm-toctree">
        <li class="wm-toc-li wm-toc-lev1 "><a href="" class="wm-article-link wm-toc-text">Home</a>
</li>
        <li class="wm-toc-li wm-toc-lev1 "><a href="quickstart/" class="wm-article-link wm-toc-text">Quick Start</a>
</li>
        <li class="wm-toc-li wm-toc-lev1 "><a href="user-guide/" class="wm-article-link wm-toc-text">User Guide</a>
</li>
        <li class="wm-toc-li wm-toc-lev1 "><a href="samples/" class="wm-article-link wm-toc-text">Samples</a>
</li>
  </ul>
</nav>

    <div class="wm-content-pane">
      <iframe class="wm-article" name="article"></iframe>
    </div>
  </div>

<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <h1 id="access-jmx-in-the-coherence-cluster-using-jconsole-and-visualvm">Access JMX in the Coherence Cluster Using JConsole and VisualVM</h1>
<p>Java Management Extensions (JMX) is the standard way to inspect and manage enterprise Java applications.  Applications that are exposed via JMX do not incur runtime performance penalty for doing so unless a tool is actively connected to the JMX connection, and only then in certain cases.  <a href="https://docs.oracle.com/javase/tutorial/">The Java Tutorials</a> provide
<a href="https://docs.oracle.com/javase/tutorial/jmx/index.html">introduction to JMX</a>.  </p>
<p>The <a href="https://docs.oracle.com/middleware/12213/coherence/COHMG/toc.htm">Coherence documentation</a>
describes <a href="https://docs.oracle.com/middleware/12213/coherence/COHMG/using-jmx-manage-oracle-coherence.htm#COHMG239">how to use JMX with Coherence</a>.</p>
<p>All the capabilities of JMX with Coherence are also available with the operator.</p>
<p>This sample shows how to connect to a Coherence JMX MBean Server when using the Coherence Operator. The option <code>--set store.jmx.enabled=true</code> is used which creates an MBean Server pod from which you can connect to the operator.</p>
<p>By default, there is one replica for the MBean Server. You can create more MBean server pods by setting the <code>store.jmx.replicas</code> value. For example, <code>--set store.jmx.replicas=2</code>.</p>
<p>See <a href="../../management/rest/">here</a> for information about connecting to Management over REST endpoint.</p>
<p><a href="../">Return to Management samples</a> / <a href="../../#list-of-samples">Return to samples</a></p>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li>Install the Coherence Operator</li>
</ol>
<p>Ensure you have installed the Coherence Operator using the instructions <a href="../../../README.md#install-the-coherence-operator">here</a>.</p>
<ol>
<li>Download the JMXMP connector JAR</li>
</ol>
<p>The JMX endpoint does not use RMI, instead it uses JMXMP. This requires an additional JAR on the classpath
   of the Java JMX client (VisualVM and JConsole). You can use curl to download the required JAR.</p>
<p><code>bash
   curl http://central.maven.org/maven2/org/glassfish/external/opendmk_jmxremote_optional_jar/1.0-b01-ea/opendmk_jmxremote_optional_jar-1.0-b01-ea.jar \
        -o opendmk_jmxremote_optional_jar-1.0-b01-ea.jar</code>     </p>
<p>This also can be downloaded as a Maven dependency if you are connecting through a Maven project.</p>
<p><code>xml
   &lt;dependency&gt;
      &lt;groupId&gt;org.glassfish.external&lt;/groupId&gt;
      &lt;artifactId&gt;opendmk_jmxremote_optional_jar&lt;/artifactId&gt;
      &lt;version&gt;1.0-b01-ea&lt;/version&gt;
   &lt;/dependency&gt;</code></p>
<h2 id="installation-steps">Installation Steps</h2>
<ol>
<li>Install the Coherence cluster</li>
</ol>
<p>Install the cluster with one MBean server pod:</p>
<p><code>bash
   $ helm install \
      --namespace sample-coherence-ns \
      --name storage \
      --set clusterSize=3 \
      --set cluster=coherence-cluster \
      --set imagePullSecrets=sample-coherence-secret \
      --set prometheusoperator.enabled=false \
      --set logCaptureEnabled=false \
      --set store.jmx.enabled=true \
      --set store.jmx.replicas=1 \
      coherence/coherence</code></p>
<p><em>Note</em>: There are many other <code>store.jmx.*</code> options which control other aspects of the MBean Server node.
   Refer to the <a href="https://github.com/oracle/coherence-operator/blob/master/operator/src/main/helm/coherence/values.yaml"><code>Coherence Operator values.yaml</code></a> file
   for more information.</p>
<p>After the chart is installed, instructions are displayed to help you utilize this feature.
   You can follow these instructions or use the commands.</p>
<ol>
<li>
<p>Check whether the MBean server pod is running:</p>
<p><code>bash
$ kubectl get pods -n sample-coherence-ns</code>
<code>console
NAME                                    READY   STATUS    RESTARTS   AGE
coherence-operator-5899f6444b-tckm4     1/1     Running   0          1h
storage-coherence-0                     1/1     Running   0          29m
storage-coherence-1                     1/1     Running   0          28m
storage-coherence-2                     1/1     Running   0          27m
storage-coherence-jmx-54f5d779d-svh29   1/1     Running   0          29m</code>   </p>
<p>A pod prefixed with <code>storage-coherence-jmx</code> is displayed in the output.</p>
</li>
<li>
<p>Port forward the MBean server pod:</p>
</li>
</ol>
<p>```bash
   $ export POD_NAME=$(kubectl get pods --namespace sample-coherence-ns -l "app=coherence,release=storage,component=coherenceJMXPod" -o jsonpath="{.items[0].metadata.name}")</p>
<p>$ kubectl --namespace sample-coherence-ns port-forward $POD_NAME 9099:9099
   ```</p>
<p>Access the JMX endpoint at the URL <code>service:jmx:jmxmp://127.0.0.1:9099</code>.</p>
<ol>
<li>(Optional) Add data to a cache</li>
</ol>
<p>Connect to the Coherence console and create a cache:</p>
<p><em>Note</em>: If you do not carry out this step, then you will not see any <code>CacheMBeans</code> as described below.</p>
<p><code>bash
   $ kubectl exec -it --namespace sample-coherence-ns storage-coherence-0 bash /scripts/startCoherence.sh console</code>   </p>
<p>At the <code>Map (?):</code> prompt, type <code>cache test</code>.  This will create a cache in the service <code>PartitionedCache</code>.</p>
<p>Use the following to add 100,000 objects of size 1024 bytes, starting at index 0 and using batches of 100.</p>
<p>```bash
   bulkput 100000 1024 0 100</p>
<p>Mon Apr 15 07:37:03 GMT 2019: adding 100000 items (starting with #0) each 1024 bytes ...
   Mon Apr 15 07:37:15 GMT 2019: done putting (11578ms, 8878KB/sec, 8637 items/sec)
   ```</p>
<p>At the prompt, type <code>size</code> and it should show 100000.</p>
<p>Then, type <code>bye</code> to exit the <code>console</code>.</p>
<ol>
<li>Access through JConsole</li>
</ol>
<p>Ensure you run JConsole with the JMXMP connector on the classpath:</p>
<p><code>bash
   $ jconsole -J-Djava.class.path="$JAVA_HOME/lib/jconsole.jar:$JAVA_HOME/lib/tools.jar:opendmk_jmxremote_optional_jar-1.0-b01-ea.jar" service:jmx:jmxmp://127.0.0.1:9099</code></p>
<p>In the console UI, select the <strong>MBeans</strong> tab and then <strong>Coherence Cluster</strong> attributes. You should see the Coherence MBeans as below:</p>
<p><img alt="JConsole" src="img/jconsole.png" /></p>
<ol>
<li>Access through VisualVM</li>
</ol>
<p>Ensure you run VisualVM with the JMXMP connector on the classpath:</p>
<p><code>bash
   $ jvisualvm -cp "$JAVA_HOME/lib/tools.jar:opendmk_jmxremote_optional_jar-1.0-b01-ea.jar"</code></p>
<p><em>Note</em>: If you have downloaded VisualVM separatley, then the executable is <code>visualvm</code>.</p>
<p>From the <strong>Applications</strong> tab in the VisualVM UI, right-click on <strong>Local</strong> and select <strong>Add JMX Connection</strong>.</p>
<p>Enter <code>service:jmx:jmxmp://127.0.0.1:9099</code> for <strong>Connection</strong> and click <strong>OK</strong>.</p>
<p>A JMX connection is added. Double-click to open the new connection. You can see the <strong>Coherence</strong> MBeans under the <strong>MBeans</strong> tab. If you have installed the Coherence VisualVM plugin, you can also see a <strong>Coherence</strong> tab.</p>
<p><img alt="JVisualVM" src="img/jvisualvm.png" /></p>
<p>Refer to the <a href="https://docs.oracle.com/middleware/12213/coherence/COHMG/oracle-coherence-mbeans-reference.htm#COHMG5442">Coherence MBean Reference</a> for detailed information about Coherence MBeans.</p>
<h2 id="uninstall-the-charts">Uninstall the Charts</h2>
<p>Use the following command to delete the chart installed in this sample:</p>
<pre><code class="bash">$ helm delete storage --purge
</code></pre>

<p>Before starting another sample, ensure that all the pods are removed from previous samples.</p>
<p>If you want to remove the <code>coherence-operator</code>, then include it in the <code>helm delete</code> command.</p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>
<!--
MkDocs version : 1.0.4
Build Date UTC : 2019-09-11 10:15:21
-->